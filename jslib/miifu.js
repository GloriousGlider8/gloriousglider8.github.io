export class BitConverter{static convert1010102ToFloat(e,t,o){let r=e<<22>>22,s=e<<12>>22,a=e<<2>>22;t[3*o+0]=r/511,t[3*o+1]=s/511,t[3*o+2]=a/511}static convert8888SnormToFloat(e,t){let o=e>>16&255,r=e>>8&255,s=255&e,a=e>>24&255;o>127&&(o-=256),r>127&&(r-=256),s>127&&(s-=256),a>127&&(a-=256),t[0]=o/127,t[1]=r/127,t[2]=s/127,t[3]=a/127}static halfToFloat(e){let t,o=e>>15&1,r=e>>10&31,s=1023&e;if(0==r)if(0==s)t=o<<31;else{for(r=1;0==(1024&s);)s<<=1,r--;s&=1023,r+=112,t=o<<31|r<<23|s<<13}else if(31==r)t=o<<31|2139095040|s<<13;else{r+=112,t=o<<31|r<<23|s<<13}return BitConverter.uIntToFloat(t)}static uIntToFloat(e){const t=new Uint32Array([e]);return new DataView(t.buffer).getFloat32(0,!0)}static floatToInt(e){const t=new Float32Array([e]);return new DataView(t.buffer).getUint32(0,!0)}}export class BitfieldReader{value;#e;seek(e){this.#e=e}padding(e){this.#e+=e}readBool(){return 0!=(this.value&1<<this.#e++)}readBits(e){let t=0;for(let o=0;o<e;o++){t|=(this.value>>this.#e++&1)<<o}return t}}export class ByteReader{data;offset=0;seek(e){this.offset=e}padding(e){this.offset+=e}readByte(){return this.data[this.offset++]}readUShort(e){let t=0;for(let o=0;o<e;o++)t=t<<8|this.data[this.offset++];return t}readUInt(e){let t=0;for(let o=0;o<e;o++)t=t<<8|this.data[this.offset++];return t}readSShort(e){let t=0;for(let o=0;o<e;o++)t=t<<8|this.data[this.offset++];return 0!=(t&1<<8*e-1)&&(t-=1<<8*e),t}readSInt(e){let t=0;for(let o=0;o<e;o++)t=t<<8|this.data[this.offset++];return 0!=(t&1<<8*e-1)&&(t-=1<<8*e),t}readSLong(e){let t=0n;for(let o=0;o<e;o++)t=t<<8n|BigInt(this.data[this.offset++]);return 0!=(t&BigInt(1<<8*e-1))&&(t-=BigInt(1<<8*e)),t}getBitfield(){const e=new BitfieldReader;return e.value=this.data[this.offset++],e}readFloat(){let e=this.readUInt(4);return BitConverter.uIntToFloat(e)}readUTF8(e){return this.offset+=e,(new TextDecoder).decode(this.data.subarray(this.offset-e,this.offset-e+e))}readRaw(e,t){t.set(this.data.subarray(this.offset,this.offset+e)),this.offset+=e}}export class ZlibImpl{static decompress(e,t,o,r){throw console.log("!! DEFAULT ZlibImpl DOES NOT DO ANYTHING !!"),new Error("You're still using the default ZlibImpl, please override it!")}static compress(e,t,o,r){throw console.log("!! DEFAULT ZlibImpl DOES NOT DO ANYTHING !!"),new Error("You're still using the default ZlibImpl, please override it!")}}export const FFLiTextureFormat={GREYSCALE:0,GREYSCALE_ALPHA:1,R_G_B_A:2};export const FFLiResourceShapeElementType={POSITION:0,NORMAL:1,TEXCOORD:2,TANGENT:3,COLOR:4,INDEX:5,TRANSFORM_HAIR:6,TRANSFORM_FACELINE:7,BOUNDING_BOX:8};export class Vec3{x=NaN;y=NaN;z=NaN;fromByteReader(e){this.x=e.readFloat(),this.y=e.readFloat(),this.z=e.readFloat()}setNaN(){this.x=NaN,this.y=NaN,this.z=NaN}}export class BoundingBox{min=new Vec3;max=new Vec3;fromByteReader(e){this.min.fromByteReader(e),this.max.fromByteReader(e)}setNaN(){this.min.setNaN(),this.max.setNaN()}}export class WindowBitConverter{static fFLiResourceWindowBitsToZlibWindowBits(e){return e<=7?e+8:e>=8&&e<=15?e+16:16==e?47:15}}export class FFLiResourceLoaderObjects{resourceHeader;textureHeader;shapeHeader;textureBeard=new Array(3);textureCap=new Array(132);textureEye=new Array(62);textureEyebrow=new Array(24);textureWrinkle=new Array(12);textureMakeup=new Array(12);textureGlass=new Array(9);textureMole=new Array(2);textureMouth=new Array(37);textureMustache=new Array(6);textureNoseline=new Array(18);shapeBeard=new Array(4);shapeCapNormal=new Array(132);shapeCapHat=new Array(132);shapeFaceline=new Array(12);shapeGlass=new Array(1);shapeMask=new Array(12);shapeNoseline=new Array(18);shapeNose=new Array(18);shapeHairNormal=new Array(132);shapeHairHat=new Array(132);shapeForeheadNormal=new Array(132);shapeForeheadHat=new Array(132)}export class FFLiPartData{used=!1;header;footer;data;fromByteReader(e,t){for(let t=0;t<6;t++)this.header.elementSize[t]<=2e7&&this.header.elementSize[t]>0&&(e.seek(this.header.elementOffset[t]),e.readRaw(this.header.elementSize[t],this.data[t]));let o=!0;for(const e of this.header.elementSize)e<=2e7&&e>0&&(o=!1);o?this.setUnused():(e.seek(t-16),this.footer.fromByteReader(e))}loadHeader(e){const t=new ByteReader;return t.data=e,this.header.fromByteReader(t),this.used=!0,t}setUnused(){this.used=!1,this.header.setUnused()}}export class FFLiPartDataHeader{constructor(){for(let e=0;e<6;e++)this.transform[e]=new Vec3}elementOffset=new Int32Array(6);elementSize=new Int32Array(6);boundingBox=new BoundingBox;transform=new Array(6);fromByteReader(e){for(let t=0;t<6;t++)this.elementOffset[t]=e.readSInt(4);for(let t=0;t<6;t++)this.elementSize[t]=e.readSInt(4);this.elementSize[FFLiResourceShapeElementType.INDEX]<2e7&&(this.elementSize[FFLiResourceShapeElementType.INDEX]*=2),this.boundingBox.fromByteReader(e);for(let t=0;t<6;t++)this.transform[t].fromByteReader(e)}setUnused(){this.boundingBox.setNaN()}}export class FFLiPartDataFooter{mipOffset;width;height;format;mipCount;fromByteReader(e){this.mipOffset=e.readUInt(4),this.width=e.readUShort(2),this.height=e.readUShort(2);let t=e.readByte();t<3&&(this.format=t),this.mipCount=e.readByte(),e.padding(2)}}export class FFLiResourcePartsInfo{offset;uncompressedSize;compressedSize;compressionLevel;windowBits;memoryLevel;strategy;partData;#t=new ByteReader;fromByteReader(e,t){this.offset=e.readUInt(4),this.uncompressedSize=e.readUInt(4),console.assert(this.uncompressedSize<2e7&&this.uncompressedSize%2==0,"Uncompressed Size invalid (should pass UncompressedSize < 20000000 and (UncompressedSize % 2) == 0)"),this.compressedSize=e.readUInt(4),console.assert(this.compressedSize<=2e7,"Compressed Size too large (should be <= 20000000)"),this.compressionLevel=e.readByte(),console.assert(0==this.uncompressedSize||this.compressionLevel<11,"Compression Level invalid (should pass UncompressedSize == 0 or CompressionLevel < 11)"),this.windowBits=e.readByte(),this.memoryLevel=e.readByte(),console.assert(0==this.uncompressedSize||this.memoryLevel<9,"Memory Level invalid (should pass UncompressedSize == 0 or MemoryLevel < 9)"),this.strategy=e.readByte(),console.assert(this.strategy<=6,"Strategy too large (should be <= 6)")}loadHeader(e,t,o){if(0==this.uncompressedSize)return void this.partData.setUnused();let r=e.offset;if(e.seek(this.offset),5==this.strategy)return e.readRaw(this.compressedSize,t),this.#t=this.partData.loadHeader(t),void e.seek(r);e.readRaw(this.compressedSize,o),ZlibImpl.decompress(o,t,WindowBitConverter.fFLiResourceWindowBitsToZlibWindowBits(this.windowBits),this.uncompressedSize),this.#t=this.partData.loadHeader(t),e.seek(r)}loadPart(){this.partData.used&&this.partData.fromByteReader(this.#t,this.uncompressedSize)}}export class FFLiResourceHeader{uncompressedBufferSize;expandedBufferSize;isExpand;fromByteReader(e,t){console.assert("FFRA"==e.readUTF8(4),"Magic Header invalid (should be FFRA)"),console.assert(458752==e.readUInt(4),"Version invalid (should be 0x00070000)"),this.uncompressedBufferSize=e.readUInt(4),console.assert(this.uncompressedBufferSize>=1024,"Uncompressed Buffer Size too small (should be >=1024)"),this.expandedBufferSize=e.readUInt(4),console.assert(this.expandedBufferSize>=1,"Expanded Buffer Size too small (should be >=1)"),this.isExpand=1==e.readUInt(4)}}export class FFLiResourceTextureHeader{textureMaxSize=new Int32Array(11);fromByteReader(e,t){for(let t=0;t<11;t++)this.textureMaxSize[t]=e.readUInt(4),console.assert(this.textureMaxSize[t]<2e7&&this.textureMaxSize[t]%4==0,"Texture Max Size invalid (should pass TextureMaxSize < 20000000 and (TextureMaxSize % 4) == 0)");for(let o=0;o<3;o++)t.textureBeard[o].fromByteReader(e,t);for(let o=0;o<132;o++)t.textureCap[o].fromByteReader(e,t);for(let o=0;o<62;o++)t.textureEye[o].fromByteReader(e,t);for(let o=0;o<24;o++)t.textureEyebrow[o].fromByteReader(e,t);for(let o=0;o<12;o++)t.textureWrinkle[o].fromByteReader(e,t);for(let o=0;o<12;o++)t.textureMakeup[o].fromByteReader(e,t);for(let o=0;o<9;o++)t.textureGlass[o].fromByteReader(e,t);for(let o=0;o<2;o++)t.textureMole[o].fromByteReader(e,t);for(let o=0;o<37;o++)t.textureMouth[o].fromByteReader(e,t);for(let o=0;o<6;o++)t.textureMustache[o].fromByteReader(e,t);for(let o=0;o<18;o++)t.textureNoseline[o].fromByteReader(e,t)}}export class FFLiResourceShapeHeader{shapeMaxSize=new Int32Array(12);fromByteReader(e,t){for(let t=0;t<12;t++)this.shapeMaxSize[t]=e.readUInt(4),console.assert(this.shapeMaxSize[t]<2e7&&this.shapeMaxSize[t]%2==0,"Shape Max Size invalid (should pass ShapeMaxSize < 20000000 and (ShapeMaxSize % 2) == 0)");for(let o=0;o<4;o++)t.shapeBeard[o].fromByteReader(e,t);for(let o=0;o<132;o++)t.shapeCapNormal[o].fromByteReader(e,t);for(let o=0;o<132;o++)t.shapeCapHat[o].fromByteReader(e,t);for(let o=0;o<12;o++)t.shapeFaceline[o].fromByteReader(e,t);for(let o=0;o<1;o++)t.shapeGlass[o].fromByteReader(e,t);for(let o=0;o<12;o++)t.shapeMask[o].fromByteReader(e,t);for(let o=0;o<18;o++)t.shapeNoseline[o].fromByteReader(e,t);for(let o=0;o<18;o++)t.shapeNose[o].fromByteReader(e,t);for(let o=0;o<132;o++)t.shapeHairNormal[o].fromByteReader(e,t);for(let o=0;o<132;o++)t.shapeHairHat[o].fromByteReader(e,t);for(let o=0;o<132;o++)t.shapeForeheadNormal[o].fromByteReader(e,t);for(let o=0;o<132;o++)t.shapeForeheadHat[o].fromByteReader(e,t)}}export class FFLResource{isLoaded=!1;isAFL23=!1;isAFL=!1;fromByteReader(e,t){t.resourceHeader.fromByteReader(e,t),this.isAFL23=38809056==t.resourceHeader.expandedBufferSize,this.isAFL=this.isAFL23||37344736==t.resourceHeader.expandedBufferSize,t.textureHeader.fromByteReader(e,t),t.shapeHeader.fromByteReader(e,t),this.isLoaded=!0}}export class Ver3CharInfo{#o;#r;#s;#a;#l;#i;#n;#h;#c;#y;#d;#g;#u;#p;#f;#m;#S;#T;#B;#b;#w;#R;#C;#F;#x;#M;#A;#E;#N;#I;#Y;#v;#$;#z;#H;#L;#U;#D;#G;#X;#O;#k;#P;#V;#W;#Z=new Uint16Array(11);#_=new Uint16Array(11);#j;#q;#J;#K;#Q;#ee;#te;#oe;#re;#se;#ae;#le;#ie;#ne=new Uint8Array(10);#he;#ce=new Uint8Array(8);getMiiVersion(){return this.#o}setMiiVersion(e){this.#o=e}getFaceType(){return this.#r}setFaceType(e){this.#r=e}getFaceColor(){return this.#s}setFaceColor(e){this.#s=e}getFaceTex(){return this.#a}setFaceTex(e){this.#a=e}getFaceMake(){return this.#l}setFaceMake(e){this.#l=e}getHairType(){return this.#i}setHairType(e){this.#i=e}getHairColor(){return this.#n}setHairColor(e){this.#n=e}getHairFlip(){return this.#h}setHairFlip(e){this.#h=e}getEyeType(){return this.#c}setEyeType(e){this.#c=e}getEyeColor(){return this.#y}setEyeColor(e){this.#y=e}getEyeScale(){return this.#d}setEyeScale(e){this.#d=e}getEyeAspect(){return this.#g}setEyeAspect(e){this.#g=e}getEyeRotate(){return this.#u}setEyeRotate(e){this.#u=e}getEyeX(){return this.#p}setEyeX(e){this.#p=e}getEyeY(){return this.#f}setEyeY(e){this.#f=e}getEyebrowType(){return this.#m}setEyebrowType(e){this.#m=e}getEyebrowColor(){return this.#S}setEyebrowColor(e){this.#S=e}getEyebrowScale(){return this.#T}setEyebrowScale(e){this.#T=e}getEyebrowAspect(){return this.#B}setEyebrowAspect(e){this.#B=e}getEyebrowRotate(){return this.#b}setEyebrowRotate(e){this.#b=e}getEyebrowX(){return this.#w}setEyebrowX(e){this.#w=e}getEyebrowY(){return this.#R}setEyebrowY(e){this.#R=e}getNoseType(){return this.#C}setNoseType(e){this.#C=e}getNoseScale(){return this.#F}setNoseScale(e){this.#F=e}getNoseY(){return this.#x}setNoseY(e){this.#x=e}getMouthType(){return this.#M}setMouthType(e){this.#M=e}getMouthColor(){return this.#A}setMouthColor(e){this.#A=e}getMouthScale(){return this.#E}setMouthScale(e){this.#E=e}getMouthAspect(){return this.#N}setMouthAspect(e){this.#N=e}getMouthY(){return this.#I}setMouthY(e){this.#I=e}getMustacheType(){return this.#Y}setMustacheType(e){this.#Y=e}getBeardType(){return this.#v}setBeardType(e){this.#v=e}getBeardColor(){return this.#$}setBeardColor(e){this.#$=e}getBeardScale(){return this.#z}setBeardScale(e){this.#z=e}getBeardY(){return this.#H}setBeardY(e){this.#H=e}getGlassType(){return this.#L}setGlassType(e){this.#L=e}getGlassColor(){return this.#U}setGlassColor(e){this.#U=e}getGlassScale(){return this.#D}setGlassScale(e){this.#D=e}getGlassY(){return this.#G}setGlassY(e){this.#G=e}getMoleType(){return this.#X}setMoleType(e){this.#X=e}getMoleScale(){return this.#O}setMoleScale(e){this.#O=e}getMoleX(){return this.#k}setMoleX(e){this.#k=e}getMoleY(){return this.#P}setMoleY(e){this.#P=e}getHeight(){return this.#V}setHeight(e){this.#V=e}getBuild(){return this.#W}setBuild(e){this.#W=e}getName(){return this.#Z}setName(e,t=0){for(let o=0;o<10;o++)this.#Z[o]=e[t+o];this.#Z[10]=0}getCreatorName(){return this.#_}setCreatorName(e,t=0){for(let o=0;o<10;o++)this.#_[o]=e[t+o];this.#_[10]=0}getGender(){return this.#j}setGender(e){this.#j=e}getBirthMonth(){return this.#q}setBirthMonth(e){this.#q=e}getBirthDay(){return this.#J}setBirthDay(e){this.#J=e}getFavoriteColor(){return this.#K}setFavoriteColor(e){this.#K=e}getFavorite(){return this.#Q}setFavorite(e){this.#Q=0!=e}getCopyable(){return this.#ee}setCopyable(e){this.#ee=0!=e}getNgWord(){return this.#te}setNgWord(e){this.#te=0!=e}getLocalonly(){return this.#oe}setLocalonly(e){this.#oe=0!=e}getRegionMove(){return this.#re}setRegionMove(e){this.#re=e}getFontRegion(){return this.#se}setFontRegion(e){this.#se=e}getRoomIndex(){return this.#ae}setRoomIndex(e){this.#ae=e}getPositionInRoom(){return this.#le}setPositionInRoom(e){this.#le=e}getBirthPlatform(){return this.#ie}setBirthPlatform(e){this.#ie=e}getCreateId(){return this.#ne}setCreateId(e,t=0){this.#ne.set(e.subarray(t,t+10))}getAuthorType(){return this.#he}setAuthorType(e){this.#he=e}getAuthorId(){return this.#ce}setAuthorId(e,t=0){this.#ce.set(e.subarray(t,t+8))}isValid(){this.#o<=0&&console.log("Invalid: MiiVersion must be > 0")}dump(){console.log("Faceline:"),console.log(`  Type   = ${this.#r}`),console.log(`  Color  = ${this.#s}`),console.log(`  Tex    = ${this.#a}`),console.log(`  Make   = ${this.#l}`),console.log(""),console.log("Hair:"),console.log(`  Type   = ${this.#i}`),console.log(`  Color  = ${this.#n}`),console.log(`  Flip   = ${this.#h}`),console.log(""),console.log("Eye:"),console.log(`  Type   = ${this.#c}`),console.log(`  Color  = ${this.#y}`),console.log(`  Scale  = ${this.#d}`),console.log(`  Aspect = ${this.#g}`),console.log(`  Rotate = ${this.#u}`),console.log(`  X      = ${this.#p}`),console.log(`  Y      = ${this.#f}`),console.log(""),console.log("Eyebrow:"),console.log(`  Type   = ${this.#m}`),console.log(`  Color  = ${this.#S}`),console.log(`  Scale  = ${this.#T}`),console.log(`  Aspect = ${this.#B}`),console.log(`  Rotate = ${this.#b}`),console.log(`  X      = ${this.#w}`),console.log(`  Y      = ${this.#R}`),console.log(""),console.log("Nose:"),console.log(`  Type  = ${this.#C}`),console.log(`  Scale = ${this.#F}`),console.log(`  Y     = ${this.#x}`),console.log(""),console.log("Mouth:"),console.log(`  Type   = ${this.#M}`),console.log(`  Color  = ${this.#A}`),console.log(`  Scale  = ${this.#E}`),console.log(`  Aspect = ${this.#N}`),console.log(`  Y      = ${this.#I}`),console.log(""),console.log("Beard:"),console.log(`  Mustache = ${this.#Y}`),console.log(`  Type     = ${this.#v}`),console.log(`  Color    = ${this.#$}`),console.log(`  Scale    = ${this.#z}`),console.log(`  Y        = ${this.#H}`),console.log(""),console.log("Glasses:"),console.log(`  Type  = ${this.#L}`),console.log(`  Color = ${this.#U}`),console.log(`  Scale = ${this.#D}`),console.log(`  Y     = ${this.#G}`),console.log(""),console.log("Mole:"),console.log(`  Type  = ${this.#X}`),console.log(`  Scale = ${this.#O}`),console.log(`  X     = ${this.#k}`),console.log(`  Y     = ${this.#P}`),console.log(""),console.log("Body:"),console.log(`  Height = ${this.#V}`),console.log(`  Build  = ${this.#W}`),console.log(""),console.log(`Gender         = ${this.#j}`),console.log(`Birthday       = ${this.#q}/${this.#J}`),console.log(`FavoriteColor  = ${this.#K}`),console.log("Favorite       = "+(this.#Q?"true":"false")),console.log("Copyable       = "+(this.#ee?"true":"false")),console.log("NG Word        = "+(this.#te?"true":"false")),console.log("Local Only     = "+(this.#oe?"true":"false")),console.log(""),console.log(`Region Move    = ${this.#re}`),console.log(`Font Region    = ${this.#se}`),console.log(`Room Index     = ${this.#ae}`),console.log(`Room Position  = ${this.#le}`),console.log(`Birth Platform = ${this.#ie}`),console.log(""),console.log("Create ID:");let e="";for(let t=0;t<10;t++)e+=`${this.#ne[t].toString(16).toUpperCase().padStart(2,"0")} `;console.log(e),console.log(`Author Type    = ${this.#he}`),console.log("Author ID:");let t="";for(let e=0;e<8;e++)t+=`${this.#ce[e].toString(16).toUpperCase().padStart(2,"0")} `;console.log(t),console.log("Name (UTF-16):");let o="";for(let e=0;e<11;e++)o+=`${this.#Z[e].toString(16).toUpperCase().padStart(4,"0")} `;console.log(o),console.log("Creator Name (UTF-16):");let r="";for(let e=0;e<11;e++)r+=`${this.#_[e].toString(16).toUpperCase().padStart(4,"0")} `;console.log(r)}}export class Ver3StoreData{static LENGTH=96;static toStoreDataBytes(e,t){for(let t=0;t<96;t++)e[t]=0;let o;e[0]=-256&e[0]|(255&t.getMiiVersion())<<0,e[1]=-2&e[1]|(t.getCopyable()?1:0)<<0,e[1]=-3&e[1]|(t.getNgWord()?1:0)<<1,e[1]=-13&e[1]|(3&t.getRegionMove())<<2,e[1]=-49&e[1]|(3&t.getFontRegion())<<4,e[2]=-16&e[2]|(15&t.getRoomIndex())<<0,e[2]=-241&e[2]|(15&t.getPositionInRoom())<<4,e[3]=-16&e[3]|(15&t.getAuthorType())<<0,e[3]=-113&e[3]|(7&t.getBirthPlatform())<<4,e.set(t.getAuthorId().subarray(0,8),4),e.set(t.getCreateId().subarray(0,10),12),e[24]=-2&e[24]|(1&t.getGender())<<0,e[24]=-31&e[24]|(15&t.getBirthMonth())<<1,o=e[24]|e[25]<<8,o=-993&o|(31&t.getBirthDay())<<5,e[24]=255&o,e[25]=o>>8&255,e[25]=-61&e[25]|(15&t.getFavoriteColor())<<2,e[25]=-65&e[25]|(t.getFavorite()?1:0)<<6;let r=t.getName();for(let t=0;t<10;t++)e[26+2*t]=r[t],e[26+2*t+1]=r[t]>>8;e[46]=t.getHeight(),e[47]=t.getBuild(),e[48]=-2&e[48]|(t.getLocalonly()?1:0)<<0,e[48]=-31&e[48]|(15&t.getFaceType())<<1,e[48]=-225&e[48]|(7&t.getFaceColor())<<5,e[49]=-16&e[49]|(15&t.getFaceTex())<<0,e[49]=-241&e[49]|(15&t.getFaceMake())<<4,e[50]=-256&e[50]|(255&t.getHairType())<<0,e[51]=-8&e[51]|(7&t.getHairColor())<<0,e[51]=-9&e[51]|(1&t.getHairFlip())<<3,e[52]=-64&e[52]|(63&t.getEyeType())<<0,o=e[52]|e[53]<<8,o=-449&o|(7&t.getEyeColor())<<6,e[52]=o,e[53]=o>>8,e[53]=-31&e[53]|(15&t.getEyeScale())<<1,e[53]=-225&e[53]|(7&t.getEyeAspect())<<5,e[54]=-32&e[54]|(31&t.getEyeRotate())<<0,o=e[54]|e[55]<<8,o=-481&o|(15&t.getEyeX())<<5,e[54]=o,e[55]=o>>8,e[55]=-63&e[55]|(31&t.getEyeY())<<1,e[56]=-32&e[56]|(31&t.getEyebrowType())<<0,e[56]=-225&e[56]|(7&t.getEyebrowColor())<<5,e[57]=-16&e[57]|(15&t.getEyebrowScale())<<0,e[57]=-113&e[57]|(7&t.getEyebrowAspect())<<4,e[58]=-32&e[58]|(31&t.getEyebrowRotate())<<0,o=e[58]|e[59]<<8,o=-481&o|(15&t.getEyebrowX())<<5,e[58]=255&o,e[59]=o>>8&255,e[59]=-63&e[59]|(31&t.getEyebrowY())<<1,e[60]=-32&e[60]|(31&t.getNoseType())<<0,o=e[60]|e[61]<<8,o=-481&o|(15&t.getNoseScale())<<5,e[60]=255&o,e[61]=o>>8&255,e[61]=-63&e[61]|(31&t.getNoseY())<<1,e[62]=-64&e[62]|(63&t.getMouthType())<<0,o=e[62]|e[63]<<8,o=-449&o|(7&t.getMouthColor())<<6,e[62]=255&o,e[63]=o>>8&255,e[63]=-31&e[63]|(15&t.getMouthScale())<<1,e[63]=-225&e[63]|(7&t.getMouthAspect())<<5,e[64]=-32&e[64]|(31&t.getMouthY())<<0,e[64]=-225&e[64]|(7&t.getMustacheType())<<5,e[66]=-8&e[66]|(7&t.getBeardType())<<0,e[66]=-57&e[66]|(7&t.getBeardColor())<<3,o=e[66]|e[67]<<8,o=-961&o|(15&t.getBeardScale())<<6,e[66]=255&o,e[67]=o>>8&255,e[67]=-125&e[67]|(31&t.getBeardY())<<2,e[68]=-16&e[68]|(15&t.getGlassType())<<0,e[68]=-113&e[68]|(7&t.getGlassColor())<<4,o=e[68]|e[69]<<8,o=-1921&o|(15&t.getGlassScale())<<7,e[68]=255&o,e[69]=o>>8&255,e[69]=-249&e[69]|(31&t.getGlassY())<<3,e[70]=-2&e[70]|(1&t.getMoleType())<<0,e[70]=-31&e[70]|(15&t.getMoleScale())<<1,o=e[70]|e[71]<<8,o=-993&o|(31&t.getMoleX())<<5,e[70]=255&o,e[71]=o>>8&255,e[71]=-125&e[71]|(31&t.getMoleY())<<2;let s=t.getCreatorName();for(let t=0;t<10;t++)e[72+2*t]=255&s[t],e[72+2*t+1]=s[t]>>8&255;let a=Crc16Ccitt.calculate(e,94,0);e[94]=a>>8,e[95]=255&a}static setFromBytes(e,t){t.setMiiVersion(e[0]),t.setCopyable(1&e[1]),t.setNgWord(e[1]>>1&1),t.setRegionMove(e[1]>>2&3),t.setFontRegion(e[1]>>4&3),t.setRoomIndex(15&e[2]),t.setPositionInRoom(e[2]>>4),t.setAuthorType(15&e[3]),t.setBirthPlatform(e[3]>>4&7),t.setAuthorId(e,4),t.setCreateId(e,12),t.setGender(1&e[24]),t.setBirthMonth(e[24]>>1&15),t.setBirthDay((3&e[25])<<3|e[24]>>5),t.setFavoriteColor(e[25]>>2&15),t.setFavorite(e[25]>>6&1);const o=new Uint16Array(10);for(let t=0;t<10;t++)o[t]=0|e[26+2*t];t.setName(o),t.setHeight(e[46]),t.setBuild(e[47]),t.setLocalonly(1&e[48]),t.setFaceType(e[48]>>1&15),t.setFaceColor(e[48]>>5),t.setFaceTex(15&e[49]),t.setFaceMake(e[49]>>4),t.setHairType(e[50]),t.setHairColor(7&e[51]),t.setHairFlip(e[51]>>3&1),t.setEyeType(63&e[52]),t.setEyeColor((1&e[53])<<2|e[52]>>6),t.setEyeScale(e[53]>>1&15),t.setEyeAspect(e[53]>>5),t.setEyeRotate(31&e[54]),t.setEyeX((1&e[55])<<3|e[54]>>5),t.setEyeY(e[55]>>1&31),t.setEyebrowType(31&e[56]),t.setEyebrowColor(e[56]>>5),t.setEyebrowScale(15&e[57]),t.setEyebrowAspect(e[57]>>4&7),t.setEyebrowRotate(31&e[58]),t.setEyebrowX((1&e[59])<<3|e[58]>>5),t.setEyebrowY(e[59]>>1&31),t.setNoseType(31&e[60]),t.setNoseScale((1&e[61])<<3|e[60]>>5),t.setNoseY(e[61]>>1&31),t.setMouthType(63&e[62]),t.setMouthColor((1&e[63])<<2|e[62]>>6),t.setMouthScale(e[63]>>1&15),t.setMouthAspect(e[63]>>5),t.setMouthY(31&e[64]),t.setMustacheType(e[64]>>5),t.setBeardType(7&e[66]),t.setBeardColor(e[66]>>3&7),t.setBeardScale((3&e[67])<<2|e[66]>>6),t.setBeardY(e[67]>>2&31),t.setGlassType(15&e[68]),t.setGlassColor(e[68]>>4&7),t.setGlassScale(2*(7&e[69])|e[68]>>7),t.setGlassY(e[69]>>3),t.setMoleType(1&e[70]),t.setMoleScale(e[70]>>1&15),t.setMoleX((3&e[71])<<3|e[70]>>5),t.setMoleY(e[71]>>2&31);const r=new Uint16Array(10);for(let t=0;t<10;t++)r[t]=0|e[72+2*t];t.setCreatorName(r)}}export class Crc16Ccitt{static calculate(e,t,o=0){return Crc16Ccitt.calculateFast(e,t,o)}static calculateShift(e,t,o=0){let r=o;for(let o=0;o<t;o++){r^=e[o]<<8;for(let e=0;e<8;e++)r=0!=(32768&r)?65535&(r<<1^4129):r<<1&65535}return r}static calculateFast(e,t,o=0){let r=o>>8,s=255&o;for(let o=0;o<t;o++){let t=e[o]^r;t^=t>>4,r=255&(s^t>>3^t<<4),s=255&(t^t<<5)}return r<<8|s}}export class Utf16ToUtf8Converter{static convert(e,t){let o=new Uint8Array(4*t),r=0,s=0;for(;s<t;){let a=e[s++];if(s<t&&a>=55296&&a<=56319){let t=e[s];t>=56320&&t<=57343&&(a=65536+((1023&a)<<10)+(1023&t),s++)}a>=55296&&a<=57343&&(a=65533),a<128?o[r++]=a:a<2048?(o[r++]=192|a>>6,o[r++]=128|63&a):a<65536?(o[r++]=224|a>>12,o[r++]=128|a>>6&63,o[r++]=128|63&a):(o[r++]=240|a>>18,o[r++]=128|a>>12&63,o[r++]=128|a>>6&63,o[r++]=128|63&a)}return(new TextDecoder).decode(o.subarray(0,r))}}