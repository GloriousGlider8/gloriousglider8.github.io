<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
	<title>word game</title>
	<link rel="stylesheet" href="/assets/styles/common.css">
	<link rel="stylesheet" href="/assets/styles/word-game.css">
	<script src="https://kit.fontawesome.com/1a33e75b22.js" crossorigin="anonymous"></script>
</head>
<body id="body" class="background-default" style="overflow-y: auto;">
	<div class="center-cont" style="padding-top: 0%; padding-bottom: 0%;" id="center-cont">
	<form class="form-in-flex" action="javascript:doShit()">
	<h1 class="text-center">Word Game</h1>
	<p>literally just a wordle clone but it supports custom words for freeee</p>
	<button type="button" class="collapsible">Stats<i class="fa-solid fa-caret-right caret-right"></i></button>
		<div class="collapsed-content">
			<p id="stat-text"></p>
		</div>
	<input type="text" id="word" placeholder="your guess" pattern="[a-zA-Z]*" title="Only letters allowed" required>
	<button type="submit" class="button green">GUESS</button>
	<div id="game-cont">
	</div>
	</form>
	</div>
</body>
<script>
	var coll = document.getElementsByClassName("collapsible");
	var i;

		for (i = 0; i < coll.length; i++) {
		coll[i].addEventListener("click", function() {
		let content = this.nextElementSibling;
		if (content.style.height && content.style.height !== "0px") {
			content.style.border = "0px solid var(--background-200)";
			content.style.height = "0px";
		} else {
			content.style.border = "1px solid var(--background-200)";
			content.style.height = content.scrollHeight + "px";
		}
		this.classList.toggle("collapsible-active");
	});
	}
</script>
<script>
	const params = new URLSearchParams(window.location.search)

	if (!params.has("w")) {window.location.replace("/word-game/make.html")}

	const word = atob(params.get("w")).toLowerCase()
	const number = params.get("n")

	const wdLetters = word.length

	let guessedUsed = 0
	let guessedWords = ""
	let guessedResults = ""

	function updateStatText() {
		document.getElementById("stat-text").innerHTML = `${wdLetters} Letters<br/>${guessedUsed}/${number} Guesses`
	}

	updateStatText()

	document.getElementById("word").setAttribute("minlength", wdLetters)
	document.getElementById("word").setAttribute("maxlength", wdLetters)

	if (number > 10) {
		document.getElementById("center-cont").style.paddingTop = `${number / 1.05}%`
		document.getElementById("center-cont").style.paddingBottom = `${number / 1.05}%`
	}

	for (let i = 0; i < number; i++) {
		document.getElementById("game-cont").innerHTML = document.getElementById("game-cont").innerHTML.concat(`<div class="word-row" id="row${i}" style="grid-template-columns: repeat(${wdLetters}, 1fr);"></div>`)
		for (let i1 = 0; i1 < wdLetters; i1++) {
			document.getElementById(`row${i}`).innerHTML = document.getElementById(`row${i}`).innerHTML.concat(`<div class="word-panel" id="row${i}-letter${i1}"><p id="row${i}-text${i1}" style="color: transparent;">A</p></div>`)
		}
	}
	
	function doShit() {
		const guess = document.getElementById("word").value.toLowerCase()
		if (guessedUsed != 0) {
			guessedWords = guessedWords.concat(";")
			guessedResults = guessedResults.concat(";")
		}
			guessedWords = guessedWords.concat(guess)
		document.getElementById("word").value = ""

		for (let i = 0; i < wdLetters; i++) {
			document.getElementById(`row${guessedUsed}-text${i}`).innerHTML = guess.charAt(i).toUpperCase()
			document.getElementById(`row${guessedUsed}-text${i}`).style.color = "var(--text-700)"
			if (word.charAt(i) == guess.charAt(i)) {
				document.getElementById(`row${guessedUsed}-letter${i}`).classList.add("green")
				guessedResults = guessedResults.concat("g")
			} else if (word.includes(guess.charAt(i))) {
				document.getElementById(`row${guessedUsed}-letter${i}`).classList.add("yellow")
				guessedResults = guessedResults.concat("y")
			} else {
				document.getElementById(`row${guessedUsed}-letter${i}`).classList.add("red")
				guessedResults = guessedResults.concat("r")
			}
		}

		guessedUsed++

		updateStatText()

		if (guess == word) {
			window.location.href = `/word-game/yay.html?w=${btoa(word)}&n=${number}&g=${btoa(guessedWords)}&r=${guessedResults}`
		}

		if (guessedUsed == number) {
			window.location.href = `/word-game/womp-womp.html?w=${btoa(word)}&n=${number}&g=${btoa(guessedWords)}&r=${guessedResults}`
		}
	}
</script>
</html>